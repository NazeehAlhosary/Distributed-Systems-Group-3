<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Add New Class</title>
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.css" />
  <!-- <link rel="stylesheet" href="style.css"> -->
  <style>
              *{
            box-sizing: border-box;
          }

          body{
            background:#282924;
            color:#007af3;
            line-height:1.6;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding:1em;
          }

          .container{
            max-width:1170px;
            margin-left:auto;
            margin-right:auto;
            padding:1em;
          }

          ul{
            list-style: none;
            padding:0;
          }

          .brand{
            text-align: center;
          }

          .brand span{
            color:#fff;
          }

          .wrapper{
            box-shadow: 0 0 20px 0 rgba(72,94,116,0.7);
          }

          .wrapper > *{
            padding: 1em;
          }

          .company-info{
            background:#c9e6ff;
          }

          .company-info h3, .company-info ul{
            text-align: center;
            margin:0 0 1rem 0;
          }

          .contact{
            background:#f9feff;
          }

          /* FORM STYLES */
          .contact form{
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-gap:20px;
          }

          .contact form label{
            display:block;
          }

          .contact form p{
            margin:0;
          }

          .contact form .full{
            grid-column: 1 / 3;
          }

          .contact form button, .contact form input, .contact form textarea{
            width:100%;
            padding:1em;
            border:1px solid #c9e6ff;
          }

          .contact form button{
            background:#c9e6ff;
            border:0;
            text-transform: uppercase;
          }

          .contact form button:hover,.contact form button:focus{
            background:#c91010;
            color:#fff;
            outline:0;
            transition: background-color 2s ease-out;
          }
          .alert{
          text-align: center;
          padding: 10px;
          background: #76c879;
          color:#fff;
          margin-bottom:10px;
          display: none; 

          }

          /* LARGE SCREENS */
          @media(min-width:700px){
            .wrapper{
              display: grid;
              grid-template-columns: 1fr 2fr;
            }

            .wrapper > *{
              padding:2em;
            }

            .company-info h3, .company-info ul, .brand{
              text-align: left;
            }
          }
  
  </style>
</head>
<body>
  <div class="container">
    <h1 class="brand"><span> Firebase </span> Data</h1>
    <div class="wrapper animated bounceInLeft"> <!-- animated bounceInLeft -->
      <div class="company-info">
        <h3>Testing Firebase Data</h3>
    
      </div>
      <div class="contact">
        <h3 id="mainBar">Add your classes</h3>
        <div class="alert">Your message has been sent</div>
        <form id="formSubmit"> 
          <p>
            <label>Class Name</label>
            <input type="text" name="name" id="name" required>
          </p>
          <p>
            <label>Parent Class</label>
            <input type="text" name="superClass" id="superClass" >
          </p>
          <p>
            <label>Number of Methods</label>
            <input type="number" name="numMeth" id="numMeth">
          </p>
          <p>
            <label>Number of Attributes</label>
            <input type="number" name="numAtr" id="numAtr" >
          </p>
          <p class="full">
            <label>Description</label>
            <textarea name="message" id="description" rows="5"></textarea>
          </p>
          <p class="full">
            <button>Submit</button>
          </p>
        </form>
        <pre id="object"></pre>
        <ul id="list"></ul>
      </div>
    </div>
  </div>
 
  <script src="https://www.gstatic.com/firebasejs/5.5.8/firebase.js"></script>
 <!-- <script src="main.js"></script>-->
 
 <script>
   window.onload = console.log(localStorage.getItem("storageName"));
  window.onload = document.getElementById('mainBar').innerHTML += " to the project: "+localStorage.getItem("storageName");
// Initialize Firebase
var config = {
  apiKey: "AIzaSyA1uXkc8gQTjysEtyWBhcc1dnbgRlTciEw",
  authDomain: "distributed-system-group-3.firebaseapp.com",
  databaseURL: "https://distributed-system-group-3.firebaseio.com",
  projectId: "distributed-system-group-3",
  storageBucket: "distributed-system-group-3.appspot.com",
  messagingSenderId: "788433805630"
};
firebase.initializeApp(config);

// Reference messages collection

var testBN = getInputValues('name');
  var messagesRef = firebase.database().ref(localStorage.getItem("storageName"));


// Listen for form submit
document.getElementById('formSubmit').addEventListener('submit', submitForm);

  function submitForm (submitForm){
      submitForm.preventDefault();
  
      // Get the input values
      var name = getInputValues('name');
      var numMeth = getInputValues('numMeth');
      var numAtr = getInputValues('numAtr');
      var description = getInputValues('description');
      var parent = getInputValues('superClass');
      console.log("The name is "+name);
      console.log("The numMeth is "+numMeth);
      console.log("The numAtr is "+numAtr);
      console.log("The message is "+description);
      console.log("The superClass is "+superClass);
      // Save message
      saveMessage (name,parent ,description, numMeth, numAtr);
     // saveMessageTest (name, company);
      // Show alret
      document.querySelector('.alert').style.display = 'block'
      window.alert("Your data has been submitted to the database :" + localStorage.getItem("storageName"));

      //Hide alert after 3 seconds
      setTimeout(function(){
          document.querySelector('.alert').style.display = 'none'
      },3000);

      document.getElementById('formSubmit').reset();
  }

// Function to get form values
  function getInputValues(id){
      return document.getElementById(id).value;
  }
   function test(){
      return " "
  }
// Save the message to the firebase
  function saveMessage (name,parent, description, numMeth, numAtr){
      var newMessagesRef = messagesRef.push();
      newMessagesRef.set({
          name:name,
          parent:parent,
          description:description,
          numMeth:numMeth,
          numAtr:numAtr
      });
    
  }
/*
  function saveMessageWithoutPush (name, company, email, phone,message){
      var newMessagesRefTest = {
          name:name,
          company:company,
          email:email,
          phone: phone,
          message:message
      }
      messagesRef.push(newMessagesRefTest)
    
  }
*/
  /*
// Save the name and company in another path inside the messages to the firebase
function saveMessageTest (name, company){
  var newMessagesRefTest = messagesRefTest.push();
  newMessagesRefTest.set({
      name:name,
      company:company
  });
}

*/


// Get elements
const preObject = document.getElementById('object');
    const ulList = document.getElementById('list');
// Create references
    const dbRefObject = firebase.database().ref().child(localStorage.getItem("storageName"));
    const dbRefList = dbRefObject.child('Address');

// Sync objects changes
   // dbRefObject.on('value', snap => console.log(snap.val()) );

   dbRefObject.on('value', snap =>{
       preObject.innerText = JSON.stringify(snap.val(), null , 2); // the number 2 is the spacing 
   } );

// Sync List changes
    //dbRefList.on('child_added', snap => console.log(snap.val()));

    dbRefList.on('child_added', snap => {
        const li = document.createElement('li');
        li.innerText = snap.val();
        li.id = snap.key;
        ulList.appendChild(li);
    });

// update the list 
    dbRefList.on('child_changed', snap => {
        const listChanged = document.getElementById(snap.key);
        listChanged.innerText = snap.val();

    } );

// Delete an item from the list 
dbRefList.on('child_removed', snap => {
    const listremove = document.getElementById(snap.key);
    listremove.remove();

} );
  
 </script>
</body>
</html>